{% extends 'core/base.html' %} 
{% load static %} 
{% load crispy_forms_tags %} 

{% block css %} 
{% endblock %} 

{% block contenido %}
<h1 class="d-flex justify-content-center align-items-center font-weight-bold text-dark"> SUSCRIPCIÓN </h1>
<div class="container">
    <div class="row">
        <div class="col-12 m-5">
            <form method="POST">
                {% csrf_token %}
                <input class="d-flex justify-content-center align-items-center" type="text" id="montoInput" value="{{ form.monto.value }}">
                <div class="d-flex justify-content-center align-items-center">
                    <div id="btnPaypal"></div>
                </div>
            </form>
        </div>
    </div>
</div>
     

{% endblock %}

{% block js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'core/js/mensajes.js' %}"></script>
<script src="{% static 'core/js/funciones.js' %}"></script>
<script src="https://www.paypalobjects.com/api/checkout.js"></script>
	<script>
		paypal.Button.render({
			env: 'sandbox',
			client: {
				sandbox: 'AUdczilLjDrMGcZtY3F9Xqa4WAmOmJQki8I3sWy9rTnnuxmiPWNOW1RACinASsIaWMDt8QPAbg0JQ1EL',
				production: 'demo_production_client_id'
			},
			locale: 'es_CL',
			style: {
				size: 'large',
				color: 'black',
				shape: 'pill'
			},
			commit: true,
			payment: function (data, actions) {
				return actions.payment.create({
					transactions: [{
						amount: { 
							total: document.getElementById('montoInput').value,
							currency: 'USD'
						}
					}]
				});
			},
			onAuthorize: function (data, actions) {
				return actions.payment.execute().then(function () {
					// LA LOGICA DE LO QUE PASA LUEGO DEL PAGO
					Swal.fire({
						title: 'Confirmación',
						text: 'Pago realizado correctamente!, Ahora eres Suscriptor.',
						icon: 'success',
						showCancelButton: false,
						confirmButtonColor: '#3085d6',
						cancelButtonColor: '#d33',
						confirmButtonText: 'Confirmar'
					})
					// Llama a la función actualizarSuscriptor
    				actualizarSuscriptor();
				});

			},
			onCancel(data) {
				Swal.fire({
						title: 'Cancelado',
						text: 'Transacción cancelada!',
						icon: 'error',
						showCancelButton: false,
						confirmButtonColor: '#3085d6',
						cancelButtonColor: '#d33',
						confirmButtonText: 'Confirmar'
					})
			},
			onError(err) {
				Swal.fire({
						title: 'Error',
						text: 'Ha ocurrido un error con el pago',
						icon: 'error',
						showCancelButton: false,
						confirmButtonColor: '#3085d6',
						cancelButtonColor: '#d33',
						confirmButtonText: 'Confirmar'
					})
			}

		}, '#btnPaypal');
	</script>
    
{% endblock %}